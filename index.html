<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="theme-color" content="#050a18"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA</title>

<link rel="manifest" href="data:application/manifest+json,{'name':'AURA','short_name':'AURA','display':'standalone','background_color':'#050a18','theme_color':'#050a18','icons':[{'src':'https://cdn-icons-png.flaticon.com/512/3222/3222800.png','sizes':'512x512','type':'image/png'}]}">

<style>
:root {
  --ice: #a8d8ff; --blue: #4a9eff; --deep: #050a18;
  --glass: rgba(255,255,255,0.07); --glass-b: rgba(255,255,255,0.15);
  --text: #e8f4ff; --dim: rgba(232,244,255,0.45);
  --blur: blur(25px); --r: 24px; --nav: 75px;
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; width: 100%; background: var(--deep); color: var(--text); font-family: -apple-system, system-ui, sans-serif; overflow: hidden; }

/* ─── BACKGROUND ANIMÉ ─── */
#ambient { position: fixed; inset: 0; z-index: 0; }
.orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.3; animation: float 10s ease-in-out infinite; }
.o1 { width: 80vw; height: 80vw; top: -20%; left: -20%; background: radial-gradient(#1a4a8a, transparent); }
.o2 { width: 60vw; height: 60vw; bottom: -10%; right: -10%; background: radial-gradient(#0a2a5a, transparent); animation-delay: -4s; }
@keyframes float { 0%, 100% { transform: translate(0,0) scale(1); } 50% { transform: translate(-20px, 30px) scale(1.1); } }

/* ─── WALLPAPER ─── */
#wlbg { position: fixed; inset: 0; z-index: 1; background-size: cover; background-position: center; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
#wlbg::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(5,10,24,0.2) 0%, rgba(5,10,24,0.6) 100%); }
#wlbg video, #wlbg img { width: 100%; height: 100%; object-fit: cover; position: absolute; }

/* ─── APP STRUCTURE ─── */
#app { position: fixed; inset: 0; z-index: 10; display: flex; flex-direction: column; }
#pages { flex: 1; position: relative; }
.page { position: absolute; inset: 0; padding: 60px 20px; opacity: 0; pointer-events: none; transform: scale(1.05); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; align-items: center; justify-content: center; }
.page.active { opacity: 1; pointer-events: all; transform: scale(1); }

/* ─── DESIGN ÉLÉMENTS ─── */
.clk-time { font-size: min(28vw, 130px); font-weight: 800; letter-spacing: -2px; color: #fff; text-shadow: 0 10px 50px rgba(0,0,0,0.3); }
.clk-date { font-size: 14px; letter-spacing: 5px; text-transform: uppercase; color: var(--ice); opacity: 0.8; margin-top: -10px; }

.zen-ring { width: 200px; height: 200px; border-radius: 50%; border: 1px solid var(--glass-b); display: flex; align-items: center; justify-content: center; position: relative; transition: 4s ease-in-out; background: var(--glass); backdrop-filter: var(--blur); }
.zen-ring::before { content: ''; position: absolute; inset: -10px; border-radius: 50%; border: 1px solid rgba(168,216,255,0.1); }
.inhale { transform: scale(1.5); background: rgba(168,216,255,0.15); border-color: var(--ice); }

/* ─── BOUTONS & NAV ─── */
.btn-glass { background: var(--glass); border: 1px solid var(--glass-b); backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur); color: #fff; padding: 12px 24px; border-radius: 30px; font-size: 12px; letter-spacing: 2px; cursor: pointer; transition: 0.3s; margin-top: 40px; }
.btn-glass:active { transform: scale(0.95); background: var(--glass-b); }

#nav { position: fixed; bottom: 0; left: 0; right: 0; height: var(--nav); background: rgba(5,10,24,0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid var(--glass-b); display: flex; justify-content: center; gap: 50px; align-items: center; padding-bottom: env(safe-area-inset-bottom); z-index: 100; }
.nb { background: none; border: none; color: var(--dim); transition: 0.3s; padding: 10px; }
.nb.active { color: var(--ice); transform: translateY(-5px); }
.nb svg { width: 26px; height: 26px; }

/* ─── SHEET ─── */
#sheet { position: fixed; inset: 0; z-index: 300; visibility: hidden; pointer-events: none; transition: 0.4s; }
#sheet.open { visibility: visible; pointer-events: all; }
#panel { position: absolute; bottom: 0; width: 100%; background: #081024; padding: 30px 20px 50px; border-radius: 30px 30px 0 0; transform: translateY(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
#sheet.open #panel { transform: translateY(0); }
.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 20px; }
.wp-item { aspect-ratio: 9/16; border-radius: 12px; overflow: hidden; background: #111; border: 2px solid transparent; cursor: pointer; }
.wp-item img { width: 100%; height: 100%; object-fit: cover; }
</style>
</head>
<body>

<div id="ambient"><div class="orb o1"></div><div class="orb o2"></div></div>
<div id="wlbg"></div>

<div id="app">
  <div id="pages">
    <div class="page active" id="p-clock">
      <div class="clk-time" id="time">00:00</div>
      <div class="clk-date" id="date">Lundi 1 Janvier</div>
      <button class="btn-glass" onclick="openWp()">STYLE</button>
    </div>

    <div class="page" id="p-zen">
      <div class="zen-ring" id="ring">
        <span id="ztxt" style="font-size: 24px; font-weight: 200;">Prêt</span>
      </div>
      <div id="zlbl" style="margin-top: 30px; letter-spacing: 4px; color: var(--ice); font-size: 14px;">RESPIRATION</div>
      <button class="btn-glass" id="zbtn" onclick="toggleZen()">DÉMARRER</button>
    </div>
  </div>

  <nav id="nav">
    <button class="nb active" onclick="go('clock', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
    </button>
    <button class="nb" onclick="go('zen', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M3 12h1m15.364-6.364l-.707.707M6.343 17.657l-.707.707m0-11.314l.707.707m11.314 11.314l.707-.707"/></svg>
    </button>
  </nav>
</div>

<div id="sheet" onclick="if(event.target==this) closeWp()">
  <div id="panel">
    <div style="width:40px; height:4px; background:var(--glass-b); margin:0 auto 20px; border-radius:2px;"></div>
    <h3 style="font-weight: 300; letter-spacing: 2px;">AMBIANCE</h3>
    <div class="wp-grid" id="wpgrid">
      </div>
    <input type="file" id="wpinput" accept="image/*" style="display:none" onchange="addWp(this)">
    <button class="btn-glass" style="width:100%; border-style: dashed;" onclick="document.getElementById('wpinput').click()">+ AJOUTER PHOTO</button>
  </div>
</div>

<script>
// --- NAVIGATION ---
function go(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nb').forEach(b => b.classList.remove('active'));
  document.getElementById('p-'+id).classList.add('active');
  btn.classList.add('active');
}

// --- HORLOGE ---
function updateClock() {
  const n = new Date();
  document.getElementById('time').textContent = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0');
  document.getElementById('date').textContent = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(updateClock, 1000); updateClock();

// --- GESTION DES FONDS (indexedDB pour la stabilité) ---
let db;
const req = indexedDB.open("aura_style", 1);
req.onupgradeneeded = e => e.target.result.createObjectStore("items", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; loadWps(); };

function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function addWp(input) {
  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = (e) => {
    const item = { id: "wp_"+Date.now(), data: e.target.result };
    const tx = db.transaction("items", "readwrite");
    tx.objectStore("items").put(item);
    tx.oncomplete = () => { loadWps(); applyWp(item.data); };
  };
  reader.readAsDataURL(file);
}

function loadWps() {
  const grid = document.getElementById('wpgrid'); grid.innerHTML = '';
  db.transaction("items").objectStore("items").getAll().onsuccess = e => {
    e.target.result.forEach(item => {
      const div = document.createElement('div');
      div.className = 'wp-item';
      div.onclick = () => applyWp(item.data);
      div.innerHTML = `<img src="${item.data}">`;
      grid.appendChild(div);
    });
  };
}

function applyWp(url) {
  document.getElementById('wlbg').style.backgroundImage = `url(${url})`;
  localStorage.setItem('active_wp', url);
  closeWp();
}

// --- ZEN LOGIQUE ---
let zRunning = false;
let zTimer;
function toggleZen() {
  const btn = document.getElementById('zbtn');
  const ring = document.getElementById('ring');
  const txt = document.getElementById('ztxt');
  
  if(zRunning) {
    zRunning = false; clearInterval(zTimer);
    btn.textContent = "DÉMARRER"; txt.textContent = "Prêt";
    ring.className = "zen-ring"; return;
  }
  
  zRunning = true; btn.textContent = "ARRÊTER";
  let step = 0; // 0:In, 1:Hold, 2:Out
  const run = () => {
    if(step === 0) { 
      ring.className = "zen-ring inhale"; txt.textContent = "In"; 
      setTimeout(() => { if(zRunning){ step=1; run(); } }, 4000);
    } else if(step === 1) {
      ring.className = "zen-ring inhale"; txt.textContent = "Zen";
      setTimeout(() => { if(zRunning){ step=2; run(); } }, 7000);
    } else {
      ring.className = "zen-ring"; txt.textContent = "Out";
      setTimeout(() => { if(zRunning){ step=0; run(); } }, 8000);
    }
  };
  run();
}

// Restaurer fond
const lastWp = localStorage.getItem('active_wp');
if(lastWp) document.getElementById('wlbg').style.backgroundImage = `url(${lastWp})`;

// Service Worker pour l'installation
if ('serviceWorker' in navigator) {
  const sw = `self.addEventListener('fetch', e => e.respondWith(fetch(e.request)));`;
  const blob = new Blob([sw], {type: 'text/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>
</body>
</html>