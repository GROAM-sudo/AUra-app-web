<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA PURE</title>

<style>
:root { --text: #ffffff; }
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body, html { height: 100%; width: 100%; background: #000; color: var(--text); font-family: -apple-system, sans-serif; overflow: hidden; }

/* ─── WALLPAPER ─── */
#wlbg { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
#wlbg video, #wlbg img { width: 100%; height: 100%; object-fit: cover; position: absolute; }

/* ─── INTERFACE ─── */
#app { 
    position: fixed; inset: 0; z-index: 50; /* Très haut z-index */
    padding: env(safe-area-inset-top) 30px env(safe-area-inset-bottom);
    display: flex; transition: all 0.5s ease;
    pointer-events: none; /* L'app elle-même ne bloque pas, mais ses enfants oui */
}

/* Styles de l'heure */
.s0 { font-size: 28vw; font-weight: 900; letter-spacing: -5px; } 
.s1 { font-size: 22vw; font-weight: 100; letter-spacing: 5px; text-transform: uppercase; } 
.s2 { font-size: 20vw; font-family: 'Courier New', monospace; } 
.s3 { font-size: 24vw; font-family: serif; font-style: italic; } 

/* Positions */
.p0 { align-items: center; justify-content: center; text-align: center; }
.p1 { align-items: flex-start; justify-content: flex-start; text-align: left; padding-top: 40px; }
.p2 { align-items: flex-start; justify-content: flex-end; text-align: right; padding-top: 40px; }
.p3 { align-items: flex-end; justify-content: flex-start; text-align: left; padding-bottom: 100px; }
.p4 { align-items: flex-end; justify-content: flex-end; text-align: right; padding-bottom: 100px; }

/* LE TEXTE DEVIENT CLIQUABLE */
#time, #date {
    pointer-events: all !important; /* FORCE LE CLIC */
    cursor: pointer;
    display: inline-block;
    text-shadow: 0 4px 30px rgba(0,0,0,0.4);
    transition: transform 0.1s;
}
#time:active, #date:active { transform: scale(0.95); opacity: 0.7; }

/* Bouton Menu */
#ui-toggle {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    z-index: 100; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px); color: white; padding: 12px 24px; border-radius: 30px;
    font-size: 10px; letter-spacing: 2px; cursor: pointer;
}

/* Sheet */
#sheet { 
    position: fixed; inset: 0; z-index: 300; visibility: hidden; 
    background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); 
    display: flex; align-items: flex-end; transition: 0.3s;
}
#sheet.open { visibility: visible; }
#panel { width: 100%; padding: 30px; background: #000; border-radius: 30px 30px 0 0; }
.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; max-height: 40vh; overflow-y: auto; }
.wp-item { aspect-ratio: 9/16; border-radius: 10px; overflow: hidden; background: #222; border: 1px solid #333; }
.wp-item img, .wp-item video { width: 100%; height: 100%; object-fit: cover; }
.btn-add { width: 100%; padding: 18px; border-radius: 15px; background: #fff; border: none; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>

<div id="wlbg"></div>

<button id="ui-toggle" onclick="openWp()">MENU</button>

<div id="app" class="p0">
    <div>
        <div id="time" class="s0" onclick="changeStyle()">00:00</div>
        <br>
        <div id="date" style="font-size: 14px; letter-spacing: 4px; text-transform: uppercase; opacity: 0.8;" onclick="changePos()">Date</div>
    </div>
</div>

<div id="sheet" onclick="closeWp()">
    <div id="panel" onclick="event.stopPropagation()">
        <p style="color: #666; font-size: 11px; margin-bottom: 20px; text-align: center; letter-spacing: 1px;">
            CLIQUE SUR L'HEURE (STYLE) <br> CLIQUE SUR LA DATE (POSITION)
        </p>
        <div class="wp-grid" id="wpgrid"></div>
        <input type="file" id="wpinput" accept="image/*,video/*" style="display:none" onchange="addFile(this)">
        <button class="btn-add" onclick="document.getElementById('wpinput').click()">AJOUTER MEDIA LOURD</button>
    </div>
</div>

<script>
let db;
let sIndex = 0;
let pIndex = 0;

// Base de données pour vidéos lourdes
const req = indexedDB.open("AuraPureV4", 1);
req.onupgradeneeded = e => e.target.result.createObjectStore("media", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; renderGallery(); };

function addFile(input) {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const item = { id: "m_" + Date.now(), data: e.target.result, type: file.type };
        const tx = db.transaction("media", "readwrite");
        tx.objectStore("media").add(item);
        tx.oncomplete = () => { renderGallery(); setWall(item); };
    };
    reader.readAsDataURL(file);
}

function renderGallery() {
    const grid = document.getElementById('wpgrid');
    grid.innerHTML = '';
    db.transaction("media").objectStore("media").getAll().onsuccess = e => {
        const items = e.target.result;
        items.forEach(m => {
            const div = document.createElement('div');
            div.className = 'wp-item';
            div.onclick = () => setWall(m);
            div.innerHTML = m.type.includes('video') ? `<video src="${m.data}" muted></video>` : `<img src="${m.data}">`;
            grid.appendChild(div);
        });
        const last = localStorage.getItem('last_id');
        if(last) {
            const found = items.find(i => i.id === last);
            if(found) setWall(found);
        }
    };
}

function setWall(m) {
    const box = document.getElementById('wlbg');
    box.innerHTML = m.type.includes('video') ? `<video src="${m.data}" autoplay loop muted playsinline></video>` : `<img src="${m.data}">`;
    localStorage.setItem('last_id', m.id);
    closeWp();
}

function changeStyle() {
    sIndex = (parseInt(sIndex) + 1) % 4;
    document.getElementById('time').className = 's' + sIndex;
    localStorage.setItem('pref_s', sIndex);
}

function changePos() {
    pIndex = (parseInt(pIndex) + 1) % 5;
    document.getElementById('app').className = 'p' + pIndex;
    localStorage.setItem('pref_p', pIndex);
}

function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function updateClock() {
    const n = new Date();
    document.getElementById('time').innerText = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0');
    document.getElementById('date').innerText = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(updateClock, 1000); updateClock();

window.onload = () => {
    const s = localStorage.getItem('pref_s');
    const p = localStorage.getItem('pref_p');
    if(s !== null) { sIndex = s; document.getElementById('time').className = 's'+s; }
    if(p !== null) { pIndex = p; document.getElementById('app').className = 'p'+p; }
};
</script>
</body>
</html>
