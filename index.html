<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA PRO PIPETTE</title>

<style>
:root { --text-color: #ffffff; }
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body, html { height: 100%; width: 100%; background: #000; color: white; font-family: -apple-system, sans-serif; overflow: hidden; }

/* ─── WALLPAPER ─── */
#wlbg { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
#wlbg video, #wlbg img { width: 100%; height: 100%; object-fit: cover; position: absolute; }

/* ─── AFFICHAGE ─── */
#app { 
    position: fixed; inset: 0; z-index: 5; 
    padding: env(safe-area-inset-top) 40px env(safe-area-inset-bottom);
    display: flex; transition: all 0.4s ease;
    pointer-events: none;
    color: var(--text-color);
}

.s0 { font-weight: 900; letter-spacing: -5px; line-height: 0.9; } 
.s1 { font-weight: 100; letter-spacing: 5px; text-transform: uppercase; } 
.s2 { font-family: 'Courier New', monospace; font-weight: bold; } 
.s3 { font-family: serif; font-style: italic; } 

.p0 { align-items: center; justify-content: center; text-align: center; }
.p1 { align-items: flex-start; justify-content: flex-start; text-align: left; padding-top: 60px; }
.p2 { align-items: flex-start; justify-content: flex-end; text-align: right; padding-top: 60px; }
.p3 { align-items: flex-end; justify-content: flex-start; text-align: left; padding-bottom: 120px; }
.p4 { align-items: flex-end; justify-content: flex-end; text-align: right; padding-bottom: 120px; }

.time-content { text-shadow: 0 4px 40px rgba(0,0,0,0.3); }

/* ─── MENU ─── */
#menu-trigger {
    position: fixed; bottom: 30px; right: 30px; 
    z-index: 100; width: 55px; height: 55px;
    background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
}

#sheet { position: fixed; inset: 0; z-index: 300; visibility: hidden; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); display: flex; align-items: flex-end; transition: 0.3s; }
#sheet.open { visibility: visible; }
#panel { width: 100%; padding: 30px; background: #111; border-radius: 30px 30px 0 0; max-height: 85vh; overflow-y: auto; }

.menu-section { margin-bottom: 25px; }
.menu-label { font-size: 11px; letter-spacing: 2px; color: #777; margin-bottom: 12px; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }

/* INPUTS */
input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; height: 30px; }
input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; border-radius: 2px; }
input[type=range]::-webkit-slider-thumb { height: 22px; width: 22px; border-radius: 50%; background: #fff; -webkit-appearance: none; margin-top: -9px; border: 2px solid #111; }

.color-controls { display: flex; align-items: center; gap: 15px; }
input[type=color] { -webkit-appearance: none; border: none; width: 35px; height: 35px; background: none; cursor: pointer; border-radius: 50%; }
input[type=color]::-webkit-color-swatch { border: 2px solid #333; border-radius: 50%; }

.dropper-btn {
    background: #222; border: 1px solid #333; color: white;
    width: 40px; height: 40px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
}
.dropper-btn:active { background: #444; }

.btn-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
.opt-btn { padding: 10px 16px; background: #222; border: 1px solid #333; color: #fff; border-radius: 12px; font-size: 11px; }

.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
.wp-item { aspect-ratio: 9/16; border-radius: 8px; overflow: hidden; background: #222; }
.wp-item * { width: 100%; height: 100%; object-fit: cover; }
.btn-add { width: 100%; padding: 18px; border-radius: 15px; background: #fff; border: none; font-weight: bold; }
</style>
</head>
<body>

<div id="wlbg"></div>

<div id="menu-trigger" onclick="openWp()">
    <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
</div>

<div id="app" class="p0">
    <div class="time-content">
        <div id="time" class="s0" style="font-size: 25vw;">00:00</div>
        <div id="date" style="font-size: 14px; letter-spacing: 5px; text-transform: uppercase; opacity: 0.8; margin-top: 10px;">Date</div>
    </div>
</div>

<div id="sheet" onclick="closeWp()">
    <div id="panel" onclick="event.stopPropagation()">
        
        <div style="display: flex; gap: 20px; flex-direction: column;">
            <div class="menu-section">
                <div class="menu-label">Taille <span id="size-val">50%</span></div>
                <input type="range" id="size-slider" min="10" max="70" value="25" oninput="updateSize(this.value)">
            </div>
            
            <div class="menu-section">
                <div class="menu-label">Couleur & Pipette</div>
                <div class="color-controls">
                    <input type="color" id="color-picker" value="#ffffff" oninput="updateColor(this.value)">
                    <button id="dropper" class="dropper-btn" onclick="activateDropper()" title="Pipette">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 7l-10 10M16 7l1 1M7 16l-1 1M18.5 4.5a2.121 2.121 0 113 3L20 9l-3-3 1.5-1.5z"/></svg>
                    </button>
                    <span id="hex-display" style="font-family: monospace; font-size: 12px; color: #666;">#FFFFFF</span>
                </div>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-label">Style & Position</div>
            <div class="btn-row">
                <button class="opt-btn" onclick="setStyle(0)">Bold</button>
                <button class="opt-btn" onclick="setStyle(1)">Thin</button>
                <button class="opt-btn" onclick="setStyle(2)">Mono</button>
                <button class="opt-btn" onclick="setStyle(3)">Italic</button>
            </div>
            <div class="btn-row" style="margin-top:10px">
                <button class="opt-btn" onclick="setPos(0)">Milieu</button>
                <button class="opt-btn" onclick="setPos(1)">H-G</button>
                <button class="opt-btn" onclick="setPos(2)">H-D</button>
                <button class="opt-btn" onclick="setPos(3)">B-G</button>
                <button class="opt-btn" onclick="setPos(4)">B-D</button>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-label">Fonds d'écran</div>
            <div class="wp-grid" id="wpgrid"></div>
            <input type="file" id="wpinput" accept="image/*,video/*" style="display:none" onchange="addFile(this)">
            <button class="btn-add" onclick="document.getElementById('wpinput').click()">+ AJOUTER FICHIER</button>
        </div>
    </div>
</div>

<script>
let db;
const req = indexedDB.open("AuraPipetteDB", 1);
req.onupgradeneeded = e => e.target.result.createObjectStore("media", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; renderGallery(); };

// --- FONCTION PIPETTE ---
async function activateDropper() {
    if (!window.EyeDropper) {
        alert("La pipette n'est pas supportée sur ce navigateur.");
        return;
    }
    const eyeDropper = new EyeDropper();
    try {
        const result = await eyeDropper.open();
        updateColor(result.sRGBHex);
        document.getElementById('color-picker').value = result.sRGBHex;
    } catch (e) {
        console.log("Sélection annulée");
    }
}

function updateSize(val) {
    let percent = Math.round(((val - 10) / 60) * 100);
    document.getElementById('size-val').innerText = percent + "%";
    document.getElementById('time').style.fontSize = val + "vw";
    localStorage.setItem('pref_size', val);
}

function updateColor(hex) {
    document.documentElement.style.setProperty('--text-color', hex);
    document.getElementById('hex-display').innerText = hex.toUpperCase();
    localStorage.setItem('pref_color', hex);
}

function setStyle(idx) { document.getElementById('time').className = 's' + idx; localStorage.setItem('pref_s', idx); }
function setPos(idx) { document.getElementById('app').className = 'p' + idx; localStorage.setItem('pref_p', idx); }

function addFile(input) {
    const file = input.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const item = { id: "m_" + Date.now(), data: e.target.result, type: file.type };
        const tx = db.transaction("media", "readwrite");
        tx.objectStore("media").add(item);
        tx.oncomplete = () => { renderGallery(); setWall(item); };
    };
    reader.readAsDataURL(file);
}

function renderGallery() {
    const grid = document.getElementById('wpgrid'); grid.innerHTML = '';
    db.transaction("media").objectStore("media").getAll().onsuccess = e => {
        const items = e.target.result;
        items.forEach(m => {
            const div = document.createElement('div');
            div.className = 'wp-item';
            div.onclick = () => setWall(m);
            div.innerHTML = m.type.includes('video') ? `<video src="${m.data}" muted></video>` : `<img src="${m.data}">`;
            grid.appendChild(div);
        });
        const last = localStorage.getItem('last_id');
        if(last) {
            const found = items.find(i => i.id === last);
            if(found) setWall(found, true);
        }
    };
}

function setWall(m, isInit = false) {
    const box = document.getElementById('wlbg');
    box.innerHTML = m.type.includes('video') ? `<video src="${m.data}" autoplay loop muted playsinline></video>` : `<img src="${m.data}">`;
    localStorage.setItem('last_id', m.id);
    if(!isInit) closeWp();
}

function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function updateClock() {
    const n = new Date();
    document.getElementById('time').innerText = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0');
    document.getElementById('date').innerText = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(updateClock, 1000); updateClock();

window.onload = () => {
    const s = localStorage.getItem('pref_s');
    const p = localStorage.getItem('pref_p');
    const size = localStorage.getItem('pref_size');
    const color = localStorage.getItem('pref_color');
    if(s !== null) setStyle(s);
    if(p !== null) setPos(p);
    if(size !== null) { document.getElementById('size-slider').value = size; updateSize(size); }
    if(color !== null) { document.getElementById('color-picker').value = color; updateColor(color); }
    if(!window.EyeDropper) document.getElementById('dropper').style.display = 'none';
};
</script>
</body>
</html> 
