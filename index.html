<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA MINIMAL</title>

<style>
:root { --text: #ffffff; }
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body, html { height: 100%; width: 100%; background: #000; color: var(--text); font-family: -apple-system, sans-serif; overflow: hidden; }

/* ─── WALLPAPER (NET & LARGE) ─── */
#wlbg { position: fixed; inset: 0; z-index: 1; }
#wlbg video, #wlbg img { width: 100%; height: 100%; object-fit: cover; position: absolute; }

/* ─── INTERFACE MINIMALISTE ─── */
#app { position: fixed; inset: 0; z-index: 10; padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom); display: flex; transition: 0.5s cubic-bezier(0.2, 1, 0.3, 1); }

/* Positions de l'heure */
.pos-center { align-items: center; justify-content: center; text-align: center; }
.pos-top-left { align-items: flex-start; justify-content: flex-start; text-align: left; }
.pos-top-right { align-items: flex-start; justify-content: flex-end; text-align: right; }
.pos-bottom-left { align-items: flex-end; justify-content: flex-start; text-align: left; }
.pos-bottom-right { align-items: flex-end; justify-content: flex-end; text-align: right; }

/* Styles de l'heure */
.style-bold { font-size: 25vw; font-weight: 900; letter-spacing: -5px; }
.style-thin { font-size: 22vw; font-weight: 100; letter-spacing: 10px; text-transform: uppercase; }
.style-mono { font-size: 20vw; font-family: 'Courier New', monospace; font-weight: 400; }
.style-classic { font-size: 24vw; font-family: serif; font-italic: italic; }

.time-container { cursor: pointer; text-shadow: 0 4px 30px rgba(0,0,0,0.3); }
.date-label { font-size: 14px; letter-spacing: 5px; text-transform: uppercase; opacity: 0.8; margin-top: 5px; }

/* Menu caché */
#config-trigger { position: fixed; top: 10px; right: 10px; width: 40px; height: 40px; z-index: 100; opacity: 0.1; }
#sheet { position: fixed; inset: 0; z-index: 300; visibility: hidden; background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); transition: 0.3s; display: flex; align-items: flex-end; }
#sheet.open { visibility: visible; }
#panel { width: 100%; padding: 30px; border-radius: 30px 30px 0 0; }
.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
.wp-item { aspect-ratio: 9/16; border-radius: 8px; overflow: hidden; background: #222; }
.wp-item video, .wp-item img { width: 100%; height: 100%; object-fit: cover; }
.btn-add { width: 100%; padding: 15px; border-radius: 15px; background: #fff; color: #000; border: none; font-weight: bold; }
</style>
</head>
<body>

<div id="wlbg"></div>
<div id="config-trigger" onclick="openWp()"></div>

<div id="app" class="pos-center">
    <div class="time-container">
        <div id="time" class="style-bold" onclick="nextStyle()">00:00</div>
        <div id="date" class="date-label" onclick="nextPos()">Lundi 1 Janvier</div>
    </div>
</div>

<div id="sheet" onclick="if(event.target==this) closeWp()">
    <div id="panel">
        <p style="margin-bottom: 15px; font-size: 12px; opacity: 0.5;">CLIQUE SUR L'HEURE POUR LE STYLE / SUR LA DATE POUR LA POSITION</p>
        <div class="wp-grid" id="wpgrid"></div>
        <input type="file" id="wpinput" accept="image/*,video/*" style="display:none" onchange="handleFile(this)">
        <button class="btn-add" onclick="document.getElementById('wpinput').click()">+ AJOUTER VIDÉO OU PHOTO</button>
    </div>
</div>

<script>
let db;
const styles = ['style-bold', 'style-thin', 'style-mono', 'style-classic'];
const positions = ['pos-center', 'pos-top-left', 'pos-top-right', 'pos-bottom-left', 'pos-bottom-right'];
let curStyle = 0;
let curPos = 0;

// --- DATABASE (Vidéos Lourdes) ---
const req = indexedDB.open("aura_v3", 1);
req.onupgradeneeded = e => e.target.result.createObjectStore("media", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; loadMedia(); };

function handleFile(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const item = { id: "m_" + Date.now(), data: e.target.result, type: file.type };
        const tx = db.transaction("media", "readwrite");
        tx.objectStore("media").put(item);
        tx.oncomplete = () => { loadMedia(); applyMedia(item); };
    };
    reader.readAsDataURL(file);
}

function loadMedia() {
    const grid = document.getElementById('wpgrid'); grid.innerHTML = '';
    db.transaction("media").objectStore("media").getAll().onsuccess = e => {
        const items = e.target.result;
        items.forEach(m => {
            const div = document.createElement('div');
            div.className = 'wp-item';
            div.onclick = () => applyMedia(m);
            div.innerHTML = m.type.includes('video') ? `<video src="${m.data}" muted></video>` : `<img src="${m.data}">`;
            grid.appendChild(div);
        });
        const lastID = localStorage.getItem('aura_last_id');
        if(lastID) {
            const last = items.find(i => i.id === lastID);
            if(last) applyMedia(last);
        }
    };
}

function applyMedia(m) {
    const box = document.getElementById('wlbg');
    box.innerHTML = m.type.includes('video') ? `<video src="${m.data}" autoplay loop muted playsinline></video>` : `<img src="${m.data}">`;
    localStorage.setItem('aura_last_id', m.id);
    closeWp();
}

// --- PERSONNALISATION ---
function nextStyle() {
    curStyle = (curStyle + 1) % styles.length;
    const t = document.getElementById('time');
    styles.forEach(s => t.classList.remove(s));
    t.classList.add(styles[curStyle]);
    localStorage.setItem('aura_style', curStyle);
}

function nextPos() {
    curPos = (curPos + 1) % positions.length;
    const app = document.getElementById('app');
    positions.forEach(p => app.classList.remove(p));
    app.classList.add(positions[curPos]);
    localStorage.setItem('aura_pos', curPos);
}

// --- UTILITAIRES ---
function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function clock() {
    const n = new Date();
    document.getElementById('time').textContent = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0');
    document.getElementById('date').textContent = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(clock, 1000); clock();

// --- RESTAURER PRÉFÉRENCES ---
window.addEventListener('load', () => {
    const s = localStorage.getItem('aura_style');
    const p = localStorage.getItem('aura_pos');
    if(s) { curStyle = parseInt(s); document.getElementById('time').className = styles[curStyle]; }
    if(p) { curPos = parseInt(p); document.getElementById('app').className = positions[curPos]; }
});
</script>
</body>
</html>
