<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA CUSTOM</title>

<style>
:root { --text: #ffffff; }
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body, html { height: 100%; width: 100%; background: #000; color: var(--text); font-family: -apple-system, sans-serif; overflow: hidden; }

/* ─── WALLPAPER ─── */
#wlbg { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
#wlbg video, #wlbg img { width: 100%; height: 100%; object-fit: cover; position: absolute; }

/* ─── AFFICHAGE ─── */
#app { 
    position: fixed; inset: 0; z-index: 5; 
    padding: env(safe-area-inset-top) 40px env(safe-area-inset-bottom);
    display: flex; transition: all 0.4s ease;
    pointer-events: none;
}

/* Styles de base (la taille sera écrasée par le slider) */
.s0 { font-weight: 900; letter-spacing: -5px; line-height: 0.9; } 
.s1 { font-weight: 100; letter-spacing: 5px; text-transform: uppercase; } 
.s2 { font-family: 'Courier New', monospace; font-weight: bold; } 
.s3 { font-family: serif; font-style: italic; } 

.p0 { align-items: center; justify-content: center; text-align: center; }
.p1 { align-items: flex-start; justify-content: flex-start; text-align: left; padding-top: 60px; }
.p2 { align-items: flex-start; justify-content: flex-end; text-align: right; padding-top: 60px; }
.p3 { align-items: flex-end; justify-content: flex-start; text-align: left; padding-bottom: 120px; }
.p4 { align-items: flex-end; justify-content: flex-end; text-align: right; padding-bottom: 120px; }

.time-content { text-shadow: 0 4px 40px rgba(0,0,0,0.6); }

/* ─── MENU TRIGGER ─── */
#menu-trigger {
    position: fixed; bottom: 30px; right: 30px; 
    z-index: 100; width: 50px; height: 50px;
    background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
}

/* ─── PANEL ─── */
#sheet { 
    position: fixed; inset: 0; z-index: 300; visibility: hidden; 
    background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); 
    display: flex; align-items: flex-end; transition: 0.3s;
}
#sheet.open { visibility: visible; }
#panel { width: 100%; padding: 30px; background: #111; border-radius: 30px 30px 0 0; }

.menu-section { margin-bottom: 20px; }
.menu-label { font-size: 10px; letter-spacing: 2px; color: #666; margin-bottom: 10px; text-transform: uppercase; display: flex; justify-content: space-between; }

/* SLIDER STYLE */
input[type=range] {
    width: 100%; -webkit-appearance: none; background: transparent; margin: 15px 0;
}
input[type=range]:focus { outline: none; }
input[type=range]::-webkit-slider-runnable-track {
    width: 100%; height: 4px; cursor: pointer; background: #333; border-radius: 2px;
}
input[type=range]::-webkit-slider-thumb {
    height: 20px; width: 20px; border-radius: 50%; background: #fff;
    cursor: pointer; -webkit-appearance: none; margin-top: -8px;
}

.btn-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
.opt-btn { 
    padding: 8px 15px; background: #222; border: 1px solid #444; 
    color: #fff; border-radius: 10px; font-size: 11px;
}
.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; max-height: 120px; overflow-y: auto; }
.wp-item { aspect-ratio: 9/16; border-radius: 6px; overflow: hidden; background: #222; }
.wp-item * { width: 100%; height: 100%; object-fit: cover; }
.btn-add { width: 100%; padding: 15px; border-radius: 12px; background: #fff; border: none; font-weight: bold; }
</style>
</head>
<body>

<div id="wlbg"></div>

<div id="menu-trigger" onclick="openWp()">
    <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
</div>

<div id="app" class="p0">
    <div class="time-content">
        <div id="time" class="s0" style="font-size: 25vw;">00:00</div>
        <div id="date" style="font-size: 14px; letter-spacing: 5px; text-transform: uppercase; opacity: 0.8;">Date</div>
    </div>
</div>

<div id="sheet" onclick="closeWp()">
    <div id="panel" onclick="event.stopPropagation()">
        
        <div class="menu-section">
            <div class="menu-label">
                <span>Taille du texte</span>
                <span id="size-val" style="color:#fff">50%</span>
            </div>
            <input type="range" id="size-slider" min="10" max="60" value="25" oninput="updateSize(this.value)">
        </div>

        <div class="menu-section">
            <div class="menu-label">Style & Position</div>
            <div class="btn-row">
                <button class="opt-btn" onclick="setStyle(0)">Bold</button>
                <button class="opt-btn" onclick="setStyle(1)">Thin</button>
                <button class="opt-btn" onclick="setStyle(2)">Mono</button>
                <button class="opt-btn" onclick="setStyle(3)">Italic</button>
            </div>
            <div class="btn-row" style="margin-top:8px">
                <button class="opt-btn" onclick="setPos(0)">Milieu</button>
                <button class="opt-btn" onclick="setPos(1)">H-G</button>
                <button class="opt-btn" onclick="setPos(2)">H-D</button>
                <button class="opt-btn" onclick="setPos(3)">B-G</button>
                <button class="opt-btn" onclick="setPos(4)">B-D</button>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-label">Fonds d'écran</div>
            <div class="wp-grid" id="wpgrid"></div>
            <input type="file" id="wpinput" accept="image/*,video/*" style="display:none" onchange="addFile(this)">
            <button class="btn-add" onclick="document.getElementById('wpinput').click()">+ AJOUTER FICHIER</button>
        </div>

    </div>
</div>

<script>
let db;
const req = indexedDB.open("AuraFinalDB", 1);
req.onupgradeneeded = e => e.target.result.createObjectStore("media", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; renderGallery(); };

function updateSize(val) {
    // On convertit la valeur du slider (10-60) en pourcentage visuel pour l'utilisateur
    let percent = Math.round((val / 60) * 100);
    document.getElementById('size-val').innerText = percent + "%";
    document.getElementById('time').style.fontSize = val + "vw";
    localStorage.setItem('pref_size', val);
}

function setStyle(idx) {
    const t = document.getElementById('time');
    t.className = 's' + idx;
    localStorage.setItem('pref_s', idx);
}

function setPos(idx) {
    document.getElementById('app').className = 'p' + idx;
    localStorage.setItem('pref_p', idx);
}

function addFile(input) {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const item = { id: "m_" + Date.now(), data: e.target.result, type: file.type };
        const tx = db.transaction("media", "readwrite");
        tx.objectStore("media").add(item);
        tx.oncomplete = () => { renderGallery(); setWall(item); };
    };
    reader.readAsDataURL(file);
}

function renderGallery() {
    const grid = document.getElementById('wpgrid'); grid.innerHTML = '';
    db.transaction("media").objectStore("media").getAll().onsuccess = e => {
        const items = e.target.result;
        items.forEach(m => {
            const div = document.createElement('div');
            div.className = 'wp-item';
            div.onclick = () => setWall(m);
            div.innerHTML = m.type.includes('video') ? `<video src="${m.data}" muted></video>` : `<img src="${m.data}">`;
            grid.appendChild(div);
        });
        const last = localStorage.getItem('last_id');
        if(last) {
            const found = items.find(i => i.id === last);
            if(found) setWall(found, true);
        }
    };
}

function setWall(m, isInit = false) {
    const box = document.getElementById('wlbg');
    box.innerHTML = m.type.includes('video') ? `<video src="${m.data}" autoplay loop muted playsinline></video>` : `<img src="${m.data}">`;
    localStorage.setItem('last_id', m.id);
    if(!isInit) closeWp();
}

function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function updateClock() {
    const n = new Date();
    document.getElementById('time').innerText = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0');
    document.getElementById('date').innerText = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(updateClock, 1000); updateClock();

window.onload = () => {
    const s = localStorage.getItem('pref_s');
    const p = localStorage.getItem('pref_p');
    const size = localStorage.getItem('pref_size');
    if(s !== null) setStyle(s);
    if(p !== null) setPos(p);
    if(size !== null) {
        document.getElementById('size-slider').value = size;
        updateSize(size);
    }
};
</script>
</body>
</html>
