<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA PRO</title>

<style>
:root { --text: #ffffff; --ui-bg: rgba(255,255,255,0.12); }
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body, html { height: 100%; width: 100%; background: #000; color: var(--text); font-family: -apple-system, sans-serif; overflow: hidden; }

/* ─── WALLPAPER NET (AUCUN FLOU) ─── */
#wlbg { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
#wlbg video, #wlbg img { width: 100%; height: 100%; object-fit: cover; position: absolute; }

/* ─── AFFICHAGE HEURE ─── */
#app { 
    position: fixed; inset: 0; z-index: 5; 
    padding: env(safe-area-inset-top) 40px env(safe-area-inset-bottom);
    display: flex; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

/* Styles de l'heure */
.s0 { font-size: 28vw; font-weight: 900; letter-spacing: -5px; line-height: 0.9; } 
.s1 { font-size: 22vw; font-weight: 100; letter-spacing: 5px; text-transform: uppercase; } 
.s2 { font-size: 20vw; font-family: 'Courier New', monospace; font-weight: bold; } 
.s3 { font-size: 24vw; font-family: serif; font-style: italic; } 

/* Positions */
.p0 { align-items: center; justify-content: center; text-align: center; }
.p1 { align-items: flex-start; justify-content: flex-start; text-align: left; padding-top: 60px; }
.p2 { align-items: flex-start; justify-content: flex-end; text-align: right; padding-top: 60px; }
.p3 { align-items: flex-end; justify-content: flex-start; text-align: left; padding-bottom: 120px; }
.p4 { align-items: flex-end; justify-content: flex-end; text-align: right; padding-bottom: 120px; }

.time-content { text-shadow: 0 4px 40px rgba(0,0,0,0.6); }

/* ─── BOUTON MENU (BAS DROITE) ─── */
#menu-trigger {
    position: fixed; bottom: 30px; right: 30px; 
    z-index: 100; width: 50px; height: 50px;
    background: var(--ui-bg); border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
#menu-trigger svg { width: 24px; height: 24px; stroke: white; }

/* ─── SHEET / MENU ─── */
#sheet { 
    position: fixed; inset: 0; z-index: 300; visibility: hidden; 
    background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); 
    display: flex; align-items: flex-end; transition: 0.3s;
}
#sheet.open { visibility: visible; }
#panel { 
    width: 100%; padding: 30px; background: #111; 
    border-radius: 30px 30px 0 0; border-top: 1px solid #333;
}

.menu-section { margin-bottom: 25px; }
.menu-label { font-size: 10px; letter-spacing: 2px; color: #666; margin-bottom: 12px; text-transform: uppercase; }
.btn-row { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
.opt-btn { 
    flex: 0 0 auto; padding: 10px 20px; background: #222; border: 1px solid #444; 
    color: #fff; border-radius: 12px; font-size: 12px; cursor: pointer;
}
.opt-btn.active { background: #fff; color: #000; border-color: #fff; }

.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; max-height: 200px; overflow-y: auto; }
.wp-item { aspect-ratio: 9/16; border-radius: 8px; overflow: hidden; background: #222; border: 1px solid #333; }
.wp-item img, .wp-item video { width: 100%; height: 100%; object-fit: cover; }
.btn-add { width: 100%; padding: 18px; border-radius: 15px; background: #fff; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
</style>
</head>
<body>

<div id="wlbg"></div>

<div id="menu-trigger" onclick="openWp()">
    <svg fill="none" viewBox="0 0 24 24" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round"/></svg>
</div>

<div id="app" class="p0">
    <div class="time-content">
        <div id="time" class="s0">00:00</div>
        <div id="date" style="font-size: 14px; letter-spacing: 5px; text-transform: uppercase; opacity: 0.8; margin-top: 10px;">Lundi 1 Janvier</div>
    </div>
</div>

<div id="sheet" onclick="closeWp()">
    <div id="panel" onclick="event.stopPropagation()">
        
        <div class="menu-section">
            <div class="menu-label">Style de l'heure</div>
            <div class="btn-row">
                <button class="opt-btn" onclick="setStyle(0)">Bold</button>
                <button class="opt-btn" onclick="setStyle(1)">Thin</button>
                <button class="opt-btn" onclick="setStyle(2)">Mono</button>
                <button class="opt-btn" onclick="setStyle(3)">Italic</button>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-label">Position</div>
            <div class="btn-row">
                <button class="opt-btn" onclick="setPos(0)">Milieu</button>
                <button class="opt-btn" onclick="setPos(1)">H-G</button>
                <button class="opt-btn" onclick="setPos(2)">H-D</button>
                <button class="opt-btn" onclick="setPos(3)">B-G</button>
                <button class="opt-btn" onclick="setPos(4)">B-D</button>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-label">Fonds d'écran & Vidéos</div>
            <div class="wp-grid" id="wpgrid"></div>
            <input type="file" id="wpinput" accept="image/*,video/*" style="display:none" onchange="addFile(this)">
            <button class="btn-add" onclick="document.getElementById('wpinput').click()">+ AJOUTER FICHIER</button>
        </div>

    </div>
</div>

<script>
let db;
// Utilisation de IndexedDB pour les vidéos lourdes
const req = indexedDB.open("AuraUltimateDB", 1);
req.onupgradeneeded = e => e.target.result.createObjectStore("media", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; renderGallery(); };

function addFile(input) {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const item = { id: "m_" + Date.now(), data: e.target.result, type: file.type };
        const tx = db.transaction("media", "readwrite");
        tx.objectStore("media").add(item);
        tx.oncomplete = () => { renderGallery(); setWall(item); };
    };
    reader.readAsDataURL(file);
}

function renderGallery() {
    const grid = document.getElementById('wpgrid'); grid.innerHTML = '';
    db.transaction("media").objectStore("media").getAll().onsuccess = e => {
        const items = e.target.result;
        items.forEach(m => {
            const div = document.createElement('div');
            div.className = 'wp-item';
            div.onclick = () => setWall(m);
            div.innerHTML = m.type.includes('video') ? `<video src="${m.data}" muted></video>` : `<img src="${m.data}">`;
            grid.appendChild(div);
        });
        const last = localStorage.getItem('last_id');
        if(last) {
            const found = items.find(i => i.id === last);
            if(found) setWall(found, true);
        }
    };
}

function setWall(m, isInit = false) {
    const box = document.getElementById('wlbg');
    box.innerHTML = m.type.includes('video') ? `<video src="${m.data}" autoplay loop muted playsinline></video>` : `<img src="${m.data}">`;
    localStorage.setItem('last_id', m.id);
    if(!isInit) closeWp();
}

// Fonctions de changement d'interface
function setStyle(idx) {
    document.getElementById('time').className = 's' + idx;
    localStorage.setItem('pref_s', idx);
}

function setPos(idx) {
    document.getElementById('app').className = 'p' + idx;
    localStorage.setItem('pref_p', idx);
}

function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function updateClock() {
    const n = new Date();
    document.getElementById('time').innerText = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0');
    document.getElementById('date').innerText = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(updateClock, 1000); updateClock();

window.onload = () => {
    const s = localStorage.getItem('pref_s');
    const p = localStorage.getItem('pref_p');
    if(s !== null) setStyle(s);
    if(p !== null) setPos(p);
};
</script>
</body>
</html>
