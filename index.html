<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>AURA PURE</title>

<link rel="manifest" href="data:application/manifest+json,{'name':'AURA','short_name':'AURA','display':'standalone','background_color':'#000000','theme_color':'#000000','icons':[{'src':'https://cdn-icons-png.flaticon.com/512/3222/3222800.png','sizes':'512x512','type':'image/png'}]}">

<style>
:root {
    --text: #ffffff;
    --nav-bg: rgba(0, 0, 0, 0.4);
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body { height: 100%; width: 100%; background: #000; color: var(--text); font-family: -apple-system, system-ui, sans-serif; overflow: hidden; }

/* ─── WALLPAPER NET (AUCUN FLOU) ─── */
#wlbg { 
    position: fixed; inset: 0; z-index: 1; 
    background-size: cover; background-position: center; 
}
#wlbg video, #wlbg img { 
    width: 100%; height: 100%; object-fit: cover; position: absolute; inset: 0;
}

/* ─── INTERFACE ─── */
#app { position: fixed; inset: 0; z-index: 10; display: flex; flex-direction: column; }
#pages { flex: 1; position: relative; }
.page { 
    position: absolute; inset: 0; opacity: 0; pointer-events: none; 
    transition: 0.4s; display: flex; flex-direction: column; align-items: center; justify-content: center; 
}
.page.active { opacity: 1; pointer-events: all; }

/* Typo très propre avec ombre légère pour lisibilité */
.clk-time { font-size: 28vw; font-weight: 800; letter-spacing: -5px; text-shadow: 0 4px 30px rgba(0,0,0,0.5); }
.clk-date { font-size: 14px; letter-spacing: 4px; text-transform: uppercase; margin-top: -15px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

/* Zen sans fond opaque */
.zen-ring { 
    width: 180px; height: 180px; border-radius: 50%; border: 2px solid #fff; 
    display: flex; align-items: center; justify-content: center; transition: 4s ease-in-out;
}
.inhale { transform: scale(1.6); border-width: 4px; }

/* Boutons invisibles/minimalistes */
.btn-ui { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(10px); color: #fff; padding: 10px 20px; border-radius: 20px; font-size: 11px; cursor: pointer; margin-top: 30px; }

#nav { 
    position: fixed; bottom: 0; width: 100%; height: 80px; 
    background: linear-gradient(transparent, rgba(0,0,0,0.5));
    display: flex; justify-content: center; gap: 60px; align-items: center; padding-bottom: env(safe-area-inset-bottom); z-index: 100; 
}
.nb { background: none; border: none; color: rgba(255,255,255,0.4); transition: 0.3s; }
.nb.active { color: #fff; transform: translateY(-3px); }

/* Selecteur */
#sheet { position: fixed; inset: 0; z-index: 300; visibility: hidden; transition: 0.3s; background: rgba(0,0,0,0.6); backdrop-filter: blur(15px); }
#sheet.open { visibility: visible; }
#panel { position: absolute; bottom: 0; width: 100%; padding: 20px; border-radius: 20px 20px 0 0; }
.wp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
.wp-item { aspect-ratio: 9/16; border-radius: 8px; overflow: hidden; background: #222; border: 2px solid transparent; }
.wp-item video, .wp-item img { width: 100%; height: 100%; object-fit: cover; }
</style>
</head>
<body>

<div id="wlbg"></div>

<div id="app">
    <div id="pages">
        <div class="page active" id="p-clock">
            <div class="clk-time" id="time">00:00</div>
            <div class="clk-date" id="date">-- --- ----</div>
            <button class="btn-ui" onclick="openWp()">WALLPAPER</button>
        </div>
        <div class="page" id="p-zen">
            <div class="zen-ring" id="ring"><span id="ztxt" style="font-size:24px;">Zen</span></div>
            <button class="btn-ui" id="zbtn" onclick="toggleZen()">DÉMARRER</button>
        </div>
    </div>

    <nav id="nav">
        <button class="nb active" onclick="go('clock', this)"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg></button>
        <button class="nb" onclick="go('zen', this)"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M3 12h1"/></svg></button>
    </nav>
</div>

<div id="sheet" onclick="if(event.target==this) closeWp()">
    <div id="panel">
        <div class="wp-grid" id="wpgrid"></div>
        <input type="file" id="wpinput" accept="image/*,video/*" style="display:none" onchange="handleFile(this)">
        <button class="btn-ui" style="width:100%" onclick="document.getElementById('wpinput').click()">+ AJOUTER FICHIER (VIDÉO/PHOTO)</button>
    </div>
</div>

<script>
let db;
const req = indexedDB.open("aura_ultra", 2);
req.onupgradeneeded = e => e.target.result.createObjectStore("media", {keyPath: "id"});
req.onsuccess = e => { db = e.target.result; loadMedia(); };

// --- FONCTION FICHIER LOURD ---
function handleFile(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const item = { id: "m_" + Date.now(), data: e.target.result, type: file.type };
        const tx = db.transaction("media", "readwrite");
        tx.objectStore("media").put(item);
        tx.oncomplete = () => { loadMedia(); applyMedia(item); };
    };
    reader.readAsDataURL(file); // Encode en Base64 pour le stockage permanent
}

function loadMedia() {
    const grid = document.getElementById('wpgrid'); grid.innerHTML = '';
    db.transaction("media").objectStore("media").getAll().onsuccess = e => {
        const items = e.target.result;
        items.forEach(m => {
            const div = document.createElement('div');
            div.className = 'wp-item';
            div.onclick = () => applyMedia(m);
            div.innerHTML = m.type.includes('video') ? `<video src="${m.data}" muted></video>` : `<img src="${m.data}">`;
            grid.appendChild(div);
        });
        // Appliquer le dernier fond sauvé
        const lastID = localStorage.getItem('last_id');
        if(lastID) {
            const last = items.find(i => i.id === lastID);
            if(last) applyMedia(last);
        }
    };
}

function applyMedia(m) {
    const box = document.getElementById('wlbg');
    box.innerHTML = m.type.includes('video') ? `<video src="${m.data}" autoplay loop muted playsinline></video>` : `<img src="${m.data}">`;
    localStorage.setItem('last_id', m.id);
    closeWp();
}

function openWp() { document.getElementById('sheet').classList.add('open'); }
function closeWp() { document.getElementById('sheet').classList.remove('open'); }

function go(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nb').forEach(b => b.classList.remove('active'));
    document.getElementById('p-'+id).classList.add('active');
    btn.classList.add('active');
}

function clock() {
    const n = new Date();
    document.getElementById('time').textContent = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0');
    document.getElementById('date').textContent = n.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(clock, 1000); clock();

let zRun = false;
function toggleZen() {
    zRun = !zRun;
    const ring = document.getElementById('ring');
    const btn = document.getElementById('zbtn');
    if(!zRun) { btn.textContent = "DÉMARRER"; ring.className="zen-ring"; return; }
    btn.textContent = "ARRÊTER";
    const cycle = () => {
        if(!zRun) return;
        ring.classList.add('inhale'); document.getElementById('ztxt').textContent = "In";
        setTimeout(() => {
            if(!zRun) return;
            ring.classList.remove('inhale'); document.getElementById('ztxt').textContent = "Out";
            setTimeout(cycle, 6000);
        }, 4000);
    };
    cycle();
}
</script>
</body>
</html>
